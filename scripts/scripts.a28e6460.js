(function(){angular.module("gwAnonShellApp",["angular-carousel","angular.filter","duScroll","leaflet-directive","ngAnimate","ngSanitize","ngTouch","platanus.inflector","restangular","truncate","ui.bootstrap","ui.router","youtube-embed"])}).call(this),function(){angular.module("gwAnonShellApp").animation(".animation-slide",function(){return{beforeAddClass:function(a,b,c){return"ng-hide"===b&&jQuery(a).show().slideUp(200,c),null},removeClass:function(a,b,c){return"ng-hide"===b&&jQuery(a).hide().slideDown(200,c),null}}})}.call(this),function(){angular.module("gwAnonShellApp").config(["RestangularProvider","constant.api",function(a,b){return a.setBaseUrl(b.base),a.setRequestSuffix("/"),a.setResponseExtractor(function(a,b){return null!=a.objects?a.objects:a})}])}.call(this),function(){angular.module("gwAnonShellApp").run(["$rootScope",function(a){return a.safeApply=function(a){var b;return b=this.$root.$$phase,"$apply"!==b&&"$digest"!==b?this.$apply(a):a&&"function"==typeof a?a():void 0}}])}.call(this),function(){angular.module("gwAnonShellApp").config(["$sceDelegateProvider",function(a){return a.resourceUrlWhitelist(["self"])}])}.call(this),function(){angular.module("gwAnonShellApp").run(["$rootScope","$state",function(a,b){return a.$on("$stateChangeSuccess",function(a,c,d,e,f){return b.previous={state:e,params:f}})}])}.call(this),function(){angular.module("gwAnonShellApp").config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){return c.hashPrefix("!"),b.otherwise("/"),a.state("home",{url:"/",templateUrl:"views/home.html",controller:"HomeCtrl",resolve:{places:["PlaceAggregation",function(a){return a}],cases:["Cases",function(a){return a}]}}),a.state("about",{url:"/about",templateUrl:"views/about.html"}),a.state("featured-stories",{url:"/featured-stories",templateUrl:"views/featured-stories.html",controller:"FeaturedStoriesCtrl",resolve:{cases:["Cases",function(a){return a}]}}),a.state("feedback",{url:"/feedback",templateUrl:"views/feedback.html"}),a.state("contribute",{url:"/contribute",templateUrl:"views/contribute.html"}),a.state("case",{url:"/case/:id",resolve:{companies:["Tree",function(a){return a}],currentCase:["$stateParams","$q","Cases",function(a,b,c){var d;return d=b.defer(),c.then(function(b){var c;return c=_.find(b.data,{id:1*a.id}),null!=c?d.resolve(c):d.reject("Case not found")}),d.promise}]},views:{"":{templateUrl:"views/case.html",controller:"CaseCtrl"},og:{templateUrl:"views/case.og.html",controller:"CaseCtrl"}}}),a.state("explore",{url:"/explore/:view",templateUrl:"views/explore.html",controller:"ExploreCtrl",params:{view:{value:"companies"}},resolve:{places:["PlaceAggregation",function(a){return a}]}}),a.state("explore.place",{url:"/:code?with&type",templateUrl:"views/explore.place.html",controller:"ExplorePlaceCtrl",resolve:{companies:["Tree",function(a){return a}],place:["$stateParams","$q","Crimetypes","PlaceAggregation","Coordinates","Tree",function(a,b,c,d,e,f){var g;return g=b.defer(),b.all([f,e]).then(function(b){var e,f,h;return f=b[0],null!=a.type&&(f=_.reject(f,function(b){return function(b){return 0===b.involvement_in_cases.length||!!_.find(b.involvement_in_cases,function(b){return-1===c.getMultiple(b.crimetype).indexOf(a.type)})}}())),f.hash=_.uniqueId(),e=d.getPlace(a.code,f),h=_.find(b[1],{code:a.code}),h=_.cloneDeep(h),null!=h&&null!=e?(h=angular.extend(h,e),g.resolve(h)):g.reject("Place not found.")}),g.promise}]}})}])}.call(this),function(){angular.module("gwAnonShellApp").constant("constant.api",{base:"https://www.detective.io/api/global-witness/anon-shell-companies/v1/"})}.call(this),function(){angular.module("gwAnonShellApp").constant("constant.crimetypes",{name:{"national-security":"national security",taxpayers:"taxpayers","the-vulnerable":"the vulnerable",business:"business","poor-countries":"poor countries","other-crimes":"other"},alias:{"national-security":"national-security","national security":"national-security",taxpayers:"taxpayers",taxpayer:"taxpayers","tax payer":"taxpayers","tax-payer":"taxpayers","tax-payers":"taxpayers","the vulnerable":"the-vulnerable","the vulnerables":"the-vulnerable","the-vulnerable":"the-vulnerable","the-vulnerables":"the-vulnerable",business:"business",busines:"business","poor-countries":"poor-countries","poor countries":"poor-countries","poor countrie":"poor-countries","poor country":"poor-countries",poorcountries:"poor-countries",other:"other-crimes"}})}.call(this),function(){angular.module("gwAnonShellApp").constant("constant.settings",{excludePlaces:["CAN","ATA","GRL"],url:"http://greatripoffmap.globalwitness.org/"})}.call(this),function(){angular.module("gwAnonShellApp").controller("CaseCtrl",["$scope","$timeout","$document","Utils","currentCase","companies",function(a,b,c,d,e,f){return a.case=e,a.companiesJuridictions=d.caseCompaniesJuridictions(e,f),b(function(a){return function(){return c.scrollToElement(angular.element(".header"),0,300)}}(),500)}])}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){this.scope=a,this.settings=c,this.crimetypes=d,this.state=e,this.http=f,this.q=g,this.location=h,this.document=i,this.leafletData=j,this.Restangular=k,this.Tree=l,this.Crimetypes=m,this.Companies=n,this.Coordinates=o,this.PlaceAggregation=p,this.places=q,this.readStateParams=b(this.readStateParams,this),this.readLocationSearch=b(this.readLocationSearch,this),this.resetLocation=b(this.resetLocation,this),this.allowFocus=b(this.allowFocus,this),this.focusOn=b(this.focusOn,this),this.popupOnPlace=b(this.popupOnPlace,this),this.selectSecondPlace=b(this.selectSecondPlace,this),this.selectPlace=b(this.selectPlace,this),this.hasRelationship=b(this.hasRelationship,this),this.quickSelectPlace=b(this.quickSelectPlace,this),this.renderMap=b(this.renderMap,this),this.updateFilteredValues=b(this.updateFilteredValues,this),this.addCircle=b(this.addCircle,this),this.createPolyline=b(this.createPolyline,this),this.drawVictimsLinks=b(this.drawVictimsLinks,this),this.drawVictims=b(this.drawVictims,this),this.drawCompaniesLinks=b(this.drawCompaniesLinks,this),this.drawCompanies=b(this.drawCompanies,this),this.removePolylines=b(this.removePolylines,this),this.removeCircles=b(this.removeCircles,this),this.codeToCordinates=b(this.codeToCordinates,this),this.hasCompaniesIn=b(this.hasCompaniesIn,this),this.hasVictimsIn=b(this.hasVictimsIn,this),this.getVictimsCount=b(this.getVictimsCount,this),this.getCompaniesCount=b(this.getCompaniesCount,this),this.count=b(this.count,this),this.getPlace=b(this.getPlace,this),this.filterClasses=b(this.filterClasses,this),this.setFeatureClasses=b(this.setFeatureClasses,this),this.setFeatures=b(this.setFeatures,this),this.controllerToken=_.uniqueId("map:")+":",this.document.scrollToElement(angular.element(".header"),0,300),this.scope.filterClasses=this.filterClasses,this.scope.getPlace=this.getPlace,this.scope.selectPlace=this.selectPlace,this.scope.focusOn=this.focusOn,this.scope.allowFocus=this.allowFocus,this.scope.crimetypes=this.crimetypes.name,this.scope.filterBy=function(a){return function(b){return null==b&&(b=null),a.resetLocation(),a.location.search("type",b)}}(this),this.scope.switchTo=function(a){return function(b){return null==b&&(b=null),a.resetLocation(),a.location.search("view",b)}}(this),this.scope.count=this.count,this.scope.activeType=null,this.scope.activeJuridiction=null,this.scope.activeWith=null,this.scope.activeView="companies",this.scope.mapLoading=!0,this.scope.$on("leafletDirectiveMap.click",function(a){return function(){return a.selectPlace(null)}}(this)),this.scope.$on("map.feature:click",function(a){return function(b,c){return a.selectPlace(c.id||c.properties.code)}}(this)),this.scope.$on("map.feature:dblclick",function(a){return function(b,c){return a.quickSelectPlace(c.id||c.properties.code)}}(this)),this.scope.$on("map.circle:click",function(a){return function(b,c){return a.selectPlace(c.code)}}(this)),this.scope.$on("map.circle:dblclick",function(a){return function(b,c){return a.quickSelectPlace(c.code)}}(this)),this.scope.$on("map.circle:mouseover",function(a){return function(b,c){var d;return c=a.getPlace(c.code,a.filteredValues),a.state.is("explore")&&null==a.scope.activeJuridiction&&(d="companies"===a.scope.activeView?"drawCompaniesLinks":"drawVictimsLinks",a[d](c,a.scope.activeJuridiction!==c.code)),a.popupOnPlace(c)}}(this)),this.scope.$on("map.circle:mouseout",function(a){return function(){return a.map.closePopup(),a.renderMap(!1)}}(this)),this.scope.$on("values:loaded",this.updateFilteredValues),this.scope.$watch("activeType + activeJuridiction + activeWith",this.updateFilteredValues,!0),this.scope.$watch(function(a){return function(){return a.location.search()}}(this),this.readLocationSearch,!0),this.scope.$on("$stateChangeSuccess",this.readStateParams,!0),this.readStateParams(),this.polylines=[],this.circles=[],this.values=[],this.filteredValues=this.values,this.excludePlaces=this.settings.excludePlaces,this.cachedFilteredValues={},this.q.all([this.http.get("json/usa.geo.json"),this.http.get("json/canada.geo.json"),this.http.get("json/countries.geo.json"),this.Coordinates,this.Tree,this.leafletData.getMap("main-map")]).then(function(a){return function(b){var c,d,e,f;for(a.map=b[5],a.usaFeatures=a.setFeatures(b[0].data),a.canFeatures=a.setFeatures(b[1].data),f=a.excludePlaces,d=0,e=f.length;d<e;d++)c=f[d],_.remove(b[2].data.features,{id:c});return a.wldFeatures=a.setFeatures(b[2].data),a.coordinates=b[3],a.values=b[4],a.scope.$broadcast("values:loaded",a.values),a.scope.mapLoading=!1}}(this))}return a.$inject=["$scope","constant.settings","constant.crimetypes","$state","$http","$q","$location","$document","leafletData","Restangular","Tree","Crimetypes","Companies","Coordinates","PlaceAggregation","places"],a.prototype.setFeatures=function(a){var b;return b=L.geoJson(a,{className:"explore__map__feature",onEachFeature:function(a){return function(b,c){var d,e,f,g,h;for(c.code=b.id||b.properties.code,g=["click","mouseover","mouseout","dblclick"],h=[],e=0,f=g.length;e<f;e++)d=g[e],h.push(c.on(d,function(c){return a.scope.$apply(function(){return a.scope.$broadcast("map.feature:"+c.type,b,c)})}));return h}}(this)}),b.addTo(this.map).bringToBack(),b},a.prototype.setFeatureClasses=function(){var a;if(a=function(a){return function(a,b){var c,d,e,f,g;for(d=_.pluck(a._layers,"_path"),null!=a._path&&d.push(a._path),g=[],e=0,f=d.length;e<f;e++)c=d[e],g.push($(c).attr("class","explore__map__feature "+b));return g}}(),$(this.map._container).find(".explore__map__feature").attr("class","explore__map__feature"),null!=this.scope.activeJuridiction)return _.each(this.map._layers,function(b){return function(c){if(null!=c.code){if(c.code===b.scope.activeJuridiction)return a(c,"explore__map__feature--active");if(c.code===b.scope.activeWith)return a(c,"explore__map__feature--active-with");if(b.hasRelationship(c.code))return a(c,"explore__map__feature--could-activate")}}}(this))},a.prototype.filterClasses=function(a){if(this.scope.activeType===a)return"explore__header__filters__item--active"},a.prototype.getPlace=function(a,b){var c;if(null==a&&(a=this.scope.activeJuridiction),null==b&&(b=this.filteredValues),null!=(c=this.PlaceAggregation.getPlace(a,b)))return _.extend(c,this.codeToCordinates(c.code))},a.prototype.count=function(a){switch(a){case"companies":return this.getCompaniesCount();case"victims":return this.getVictimsCount()}},a.prototype.getCompaniesCount=function(){var a,b,c;return null==(b=this.getPlace())?0:(c="victims"===this.scope.activeView?"victims_companies":"companies",null==b[c]&&(b[c]=[]),null==this.scope.activeWith?b[c].length:(a=_.filter(b[c],function(a){return function(b){return"victims_companies"===c?b.incorporations.indexOf(a.scope.activeWith)>-1:!!_.find(b.involvement_in_cases,function(b){return!!_.find(b.victims,{code:a.scope.activeWith})})}}(this)),a.length))},a.prototype.getVictimsCount=function(){var a,b;return null==(a=this.getPlace())?0:(b="victims"===this.scope.activeView?"victims_places":"victims",null==a[b]&&(a[b]=[]),a[b].length)},a.prototype.hasVictimsIn=function(a,b){return this.PlaceAggregation.hasVictimsIn(a,b,this.filteredValues)},a.prototype.hasCompaniesIn=function(a,b){return this.PlaceAggregation.hasCompaniesIn(a,b,this.filteredValues)},a.prototype.codeToCordinates=function(a){return _.find(this.coordinates||[],{code:a})},a.prototype.removeCircles=function(){return _.each(this.circles,function(a){return function(b){return a.map.removeLayer(b)}}(this))},a.prototype.removePolylines=function(){return _.each(this.polylines,function(a){return function(b){return a.map.removeLayer(b)}}(this))},a.prototype.drawCompanies=function(a,b){var c,d,e,f,g,h,i,j,k,l;if(null==a&&(a=this.filteredValues),null==b&&(b=!1),e=this.PlaceAggregation.countByPlace(a),g=_.max(e,function(a){return a.companies.length}),null!=g.companies)for(l=_.filter(e,function(a){return a.companies.length}),j=0,k=l.length;j<k;j++)h=l[j],null!=(f=this.codeToCordinates(h.code))&&(d=["explore__map__circle"],h.code===this.scope.activeJuridiction&&d.push("explore__map__circle--active"),i=5+h.companies.length/g.companies.length*30,c=L.circleMarker([f.lat,f.lng],{radius:i,className:d.join(" ")}),this.addCircle(c,h,this.map,b));return e},a.prototype.drawCompaniesLinks=function(a,b){var c,d,e,f,g,h,i;if(null==b&&(b=!1),"companies"===this.scope.activeView&&null!=a){for(h=a.victims||[],i=[],f=0,g=h.length;f<g;f++)e=h[f],null!=e.lat&&(this.createPolyline(a.code,e.code,e.code,b),d=["explore__map__extremity"],e.code===this.scope.activeWith&&d.push("explore__map__extremity--active"),c=L.circleMarker([e.lat,e.lng],{radius:3,className:d.join(" ")}),i.push(this.addCircle(c,e,this.map,b)));return i}},a.prototype.drawVictims=function(a,b){var c,d,e,f,g,h,i,j;for(null==a&&(a=this.filteredValues),null==b&&(b=!1),g=this.PlaceAggregation.countByPlace(a),j=_.filter(g,function(a){return a.victims_cases.length}),h=0,i=j.length;h<i;h++)f=j[h],null!=(e=this.codeToCordinates(f.code))&&(d=["explore__map__extremity"],f.code===this.scope.activeJuridiction&&d.push("explore__map__extremity--active"),c=L.circleMarker([e.lat,e.lng],{radius:4,className:d.join(" ")}),this.addCircle(c,f,this.map,b),c.bringToFront());return g},a.prototype.drawVictimsLinks=function(a,b){var c,d,e,f,g,h,i,j,k,l;if(null==b&&(b=!1),"victims"===this.scope.activeView&&null!=a){for(g=this.PlaceAggregation.countByPlace(this.filteredValues),e=_.max(g,function(a){return a.victims_places.length}),f=e.victims_places.length,k=a.victims_places||[],l=[],i=0,j=k.length;i<j;i++)h=k[i],_.extend(h,this.getPlace(h.code)),null!=h.lat&&(this.createPolyline(h.code,a.code,h.code,b),d=["explore__map__circle"],h.code===this.scope.activeWith&&d.push("explore__map__circle--active"),c=L.circleMarker([h.lat,h.lng],{radius:5+h.victims_places.length/f*30,className:d.join(" ")}),l.push(this.addCircle(c,h,this.map,b)));return l}},a.prototype.createPolyline=function(a,b,c,d){var e,f,g,h,i,j,k;if(null==d&&(d=!1),j=this.codeToCordinates(a),g=this.codeToCordinates(b),null!=j&&null!=g)return e=[L.latLng(j.lat,j.lng),L.latLng(g.lat,g.lng)],f=["explore__map__link"],c===this.scope.activeWith&&f.push("explore__map__link--active"),i=new L.Polyline(e,{className:f.join(" "),weight:2}),this.polylines.push(i),this.map.addLayer(i),d&&(h=d3.select(i._path),k=h.node().getTotalLength(),h.attr("stroke-dasharray",k+" "+k).attr("stroke-dashoffset",k).style("stroke-opacity",0).transition().duration(300).ease("linear").attr("stroke-dashoffset",0).style("stroke-opacity",1)),i},a.prototype.addCircle=function(a,b,c,d){var e,f,g,h,i,j,k,l;if(null==d&&(d=!1),j=this.circles.push(a)-1,a.addTo(c),_.each(["mouseover","mouseout","click","dblclick"],function(c){return function(d){return a.on(d,function(a,b){return function(b){return c.scope.$apply(function(){return c.scope.$broadcast("map.circle:"+d,a,b)})}}(b))}}(this)),d){i=d3.select(a._path),h=i.node();try{e=h.getBBox()}catch(a){return a,j}l=[e.x+e.width/2,e.y+e.height/2],f=l[0],g=l[1],k=function(a){var b,c;return"matrix("+(b=c=a)+", 0, 0, "+c+", "+(f-b*f)+", "+(g-c*g)+")"},i.attr("transform",k(0)).transition().duration(600).ease("linear").attrTween("transform",function(a,b,c){return k})}return j},a.prototype.updateFilteredValues=function(){var a;if(null!=this.map)return a="type-"+this.scope.activeType,null!=this.cachedFilteredValues[a]?this.filteredValues=this.cachedFilteredValues[a]:(this.filteredValues=_.cloneDeep(this.values),this.filteredValues.hash=_.uniqueId(this.controllerToken),null!=this.scope.activeType&&_.remove(this.filteredValues,function(a){return function(b){return null==b.involvement_in_cases||(0===b.involvement_in_cases.length||!!_.find(b.involvement_in_cases,function(b){return-1===a.Crimetypes.getMultiple(b.crimetype).indexOf(a.scope.activeType)}))}}(this)),this.cachedFilteredValues[a]=this.filteredValues),this.scope.juridictions=this.PlaceAggregation.countByPlace(this.filteredValues),this.renderMap(!this.scope.activeJuridiction&&!this.scope.activeWith)},a.prototype.renderMap=function(a){switch(null==a&&(a=!1),this.removeCircles(),this.removePolylines(),this.setFeatureClasses(),this.scope.activeView){case"victims":return null!=this.scope.activeJuridiction&&this.drawVictimsLinks(this.getPlace(),a),this.drawVictims(this.filteredValues,a);default:return null!=this.scope.activeJuridiction&&this.drawCompaniesLinks(this.getPlace(),a),this.drawCompanies(this.filteredValues,a)}},a.prototype.quickSelectPlace=function(a){return a!==this.scope.activeJuridiction&&this.hasRelationship(a)?this.state.go("explore.place",{code:this.scope.activeJuridiction,with:a}):this.state.go("explore.place",{code:a})},a.prototype.hasRelationship=function(a){return"companies"===this.scope.activeView&&this.hasVictimsIn(this.scope.activeJuridiction,a)||"victims"===this.scope.activeView&&this.hasCompaniesIn(this.scope.activeJuridiction,a)},a.prototype.selectPlace=function(a,b){if(null==b&&(b=!1),this.state.is("explore")){if(null===a||null==this.getPlace(a))return this.location.search("juridiction",null),this.location.search("with",null);if(null===this.scope.activeJuridiction||b){if(null!==a&&!this.allowFocus(a))return;return this.location.search("juridiction",a),this.location.search("with",null)}return this.selectSecondPlace(a)}return this.state.go("explore",{juridiction:null,with:null},{reload:!0})},a.prototype.selectSecondPlace=function(a){return this.hasRelationship(a)?this.location.search("with",a):this.selectPlace(a,!0)},a.prototype.popupOnPlace=function(a){var b;return null==a.lat?console.warn({error:"A place has not coordinates",place:a}):(b=new L.latLng(a.lat,a.lng),this.popup=L.popup().setLatLng(b).setContent(a.name).openOn(this.map))},a.prototype.focusOn=function(a){if(null!=a)return this.scope.placeFocus=null,this.state.go("explore.place",{code:a})},a.prototype.allowFocus=function(a){var b,c,d;return c=this.getPlace(null!=(d=a.code)?d:a),b="companies"===this.scope.activeView?"companies":"victims_cases",null!=c&&!!c[b].length},a.prototype.resetLocation=function(){var a,b,c,d,e;for(d=["type","juridiction","with"],e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push(this.location.search(a,null));return e},a.prototype.readLocationSearch=function(a){var b,c;if(this.scope.activeType=this.location.search().type||null,this.scope.activeJuridiction=null!=(b=this.location.search().juridiction)?b:null,this.scope.activeWith=null!=(c=this.location.search().with)?c:null,this.readStateParams(),null!==this.scope.activeJuridiction)return this.scope.hideHowTo=!0},a.prototype.readStateParams=function(){var a;return null!=this.state.params.code&&(this.scope.activeJuridiction=this.state.params.code),this.scope.activeView=null!=(a=this.state.params.view)?a:"companies"},a}(),angular.module("gwAnonShellApp").controller("ExploreCtrl",a)}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(a,c,d,e,f,g,h,i,j,k){switch(this.scope=a,this.stateParams=c,this.document=d,this.timeout=e,this.place=f,this.companies=g,this.leafletData=h,this.Crimetypes=i,this.PlaceAggregation=j,this.Utils=k,this.getCrimetypes=b(this.getCrimetypes,this),this.timeout(function(a){return function(){return a.document.scrollToElement(angular.element(".explore__place"),0,300)}}(this),500),this.stateParams.view){case"victims":this.scope.cases=this.place.victims_cases,this.scope.places=this.place.victims_places,null!=this.stateParams.with&&(this.scope.cases=_.filter(this.scope.cases,function(a){return function(b){var c;return c=a.Utils.caseCompaniesJuridictions(b,a.companies),!!_.find(c,{code:a.stateParams.with})}}(this)));break;default:this.scope.cases=this.place.cases,this.scope.victims=this.place.victims,null!=this.stateParams.with&&(this.scope.cases=_.filter(this.scope.cases,function(a){return function(b){return!!_.find(b.victims,{isoa3:a.stateParams.with})}}(this)))}null!=this.stateParams.with&&(this.scope.with=this.PlaceAggregation.getPlace(this.stateParams.with,this.companies),this.place.victims=_.filter(this.place.victims,{isoa3:this.stateParams.with})),this.scope.place=this.place,this.scope.crimetypes=this.getCrimetypes(this.scope.cases),this.scope.allCases=_.uniq(f.cases.concat(this.place.victims_cases),"id"),this.scope.allCrimetypes=this.getCrimetypes(this.scope.allCases),this.scope.cases=_.map(this.scope.cases,function(a){return function(b){return b.companies_juridictions=a.Utils.caseCompaniesJuridictions(b,a.companies),b}}(this)),this.scope.allCases=_.map(this.scope.allCases,function(a){return function(b){return b.companies_juridictions=a.Utils.caseCompaniesJuridictions(b,a.companies),b}}(this)),h.getMap("main-map").then(function(a){return function(b){return b.setView(L.latLng(a.place.lat,a.place.lng),4)}}(this))}return a.$inject=["$scope","$stateParams","$document","$timeout","place","companies","leafletData","Crimetypes","PlaceAggregation","Utils"],a.prototype.getCrimetypes=function(a){var b,c;return b=_.pluck(a,"crimetype"),c=[],angular.forEach(b,function(a){return function(b){return c=c.concat(a.Crimetypes.getMultiple(b))}}(this)),_.uniq(c)},a}(),angular.module("gwAnonShellApp").controller("ExplorePlaceCtrl",a)}.call(this),function(){angular.module("gwAnonShellApp").controller("HomeCtrl",["$scope","places","cases","PlaceAggregation",function(a,b,c,d){return a.places=b.length,a.cases=c.data.length}])}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(a,c,d,e,f,g,h,i){this.scope=a,this.state=c,this.timeout=d,this.modal=e,this.window=f,this.Restangular=g,this.Crimetypes=h,this.settings=i,this.tweet=b(this.tweet,this),this.download=b(this.download,this),this.share=b(this.share,this),this.print=b(this.print,this),this.scope.state=this.state,this.scope.crimetype=this.Crimetypes.get,this.scope.casecrimes=this.Crimetypes.getCaseCrimes,this.scope.print=this.print,this.scope.tweet=this.tweet,this.scope.startDownload=function(a){return function(){if(null==a.scope.downloadTimeout)return a.download()}}(this),this.scope.share=this.share}return a.$inject=["$scope","$state","$timeout","$modal","$window","Restangular","Crimetypes","constant.settings"],a.prototype.print=function(){return null!=this.window.print&&this.window.print(),null},a.prototype.share=function(){if(null==this.modalInstance)return this.modalInstance=this.modal.open({templateUrl:"views/share.html",controller:"ShareCtrl"}),this.modalInstance.result.finally(function(a){return function(){return delete a.modalInstance}}(this))},a.prototype.download=function(){return window.open("./json/data.cases.json","_blank")},a.prototype.tweet=function(){var a,b,c,d,e,f,g;return g=575,a=400,b=($(this.window).width()-g)/2,e=($(this.window).height()-a)/2,d="The Great Rip Off: a map of #anonymous companies and the people theyâ€™ve harmed from @global_witness",d=encodeURIComponent(d),f="http://twitter.com/share?text="+d,f=f+"&url="+encodeURIComponent(this.settings.url),c="status=1,width="+g+",height="+a+",top="+e+",left="+b,this.window.open(f,"twitter",c),null},a}(),angular.module("gwAnonShellApp").controller("MainCtrl",a)}.call(this),function(){angular.module("gwAnonShellApp").controller("FeaturedStoriesCtrl",["$scope","cases",function(a,b){return a.featuredCases=_.filter(b.data,{feature:!0}),a.recentCases=_.filter(b.data,function(a){return!a.feature&&a.new}),a.recentCases=_.sortBy(a.recentCases,function(a){return-1*a.id})}])}.call(this),function(){angular.module("gwAnonShellApp").directive("heightToBottom",["$window",function(a){return{restrict:"A",link:function(b,c,d){var e,f;return e="resize.heightToBottom",f=function(){if(c.css("height",a.innerHeight-c.offset().top),!isNaN(d.heightToBottom))return c.css("min-height",1*d.heightToBottom)},f(),angular.element(a).on(e,f),b.$on("$destroy",function(){return angular.element(a).off(e)})}}}])}.call(this),function(){angular.module("gwAnonShellApp").directive("href",function(){return{compile:function(a){var b;if(null!=(b=""+a[0].hostname)&&b!==""+window.location.hostname)return a.attr("target","_blank")}}})}.call(this),function(){angular.module("gwAnonShellApp").directive("map",["leafletData","$state",function(a,b){return{templateUrl:"views/map.html",restrict:"E",link:function(c,d,e){var f,g;return f=function(a){var b;return b=["dragging","touchZoom","keyboard"],{disable:function(){var c,d,e,f;for(f=[],d=0,e=b.length;d<e;d++)c=b[d],f.push(a[c].disable());return f},enable:function(){var c,d,e,f;for(f=[],d=0,e=b.length;d<e;d++)c=b[d],f.push(a[c].enable());return f}}},g=function(){return a.getMap("main-map").then(function(a){switch(b.current.name){case"explore":a.setView(L.latLng(30.71109,.7191036),2),f(a).enable();break;case"explore.place":f(a).disable()}return a.doubleClickZoom.disable()})},c.$on("$stateChangeSuccess",g),g(),angular.extend(c,{maxbounds:{southWest:L.latLng(70,180),northEast:L.latLng(-50,-180)},center:{zoom:2,lat:30.71109,lng:.7191036},defaults:{scrollWheelZoom:!1,zoomControlPosition:"topright"},tiles:{url:"./images/blank.gif",options:{opacity:0,detectRetina:!1,reuseTiles:!0}}})}}}])}.call(this),function(){"use strict";angular.module("gwAnonShellApp").directive("twitter",["$timeout",function(a){return{replace:!0,template:"<span></span>",link:function(b,c,d){return a(function(){var a;return a=d.url||document.URL,twttr.widgets.createShareButton(a,c[0],{count:"none",text:d.text,via:d.via})})}}}])}.call(this),function(){angular.module("gwAnonShellApp").factory("Cases",["$http","$rootScope",function(a,b){return a.get("./json/data.cases.json").success(function(a){return b.$broadcast("cases:loaded",a)})}])}.call(this),function(){angular.module("gwAnonShellApp").factory("Companies",["$http","$rootScope",function(a,b){return a.get("./json/data.companies.json").success(function(a){return b.$broadcast("companies:loaded",a)})}])}.call(this),function(){angular.module("gwAnonShellApp").factory("Coordinates",["$q","$http",function(a,b){return a.all([b.get("./json/canada.coordinates.json"),b.get("./json/usa.coordinates.json"),b.get("./json/countries.coordinates.json")]).then(function(a){var b,c,d,e;for(c=[],d=0,e=a.length;d<e;d++)b=a[d],c=c.concat(b.data);return c})}])}.call(this),function(){"use strict";var a=function(a,b){return function(){return a.apply(b,arguments)}};angular.module("gwAnonShellApp").service("Crimetypes",["constant.crimetypes",function(b){return new(function(){function c(){this.getCaseCrimes=a(this.getCaseCrimes,this),this.getMultiple=a(this.getMultiple,this),this.get=a(this.get,this)}return c.prototype.trim=function(a){return String(a).replace(/^\s+|\s+$/g,"")},c.prototype.get=function(a){return null==a&&(a="other"),a=a.toLowerCase(),null==b.alias[a]&&(a="other"),{slug:b.alias[a],name:b.name[b.alias[a]]}},c.prototype.getMultiple=function(a){var b,c;return null==a&&(a="other"),b=a.split(","),c=_.map(b,function(a){return function(b){return a.get(a.trim(b)).slug}}(this)),_.uniq(c)},c.prototype.getCaseCrimes=function(a){var b;return b=this.getMultiple(a.crimetype),_.map(b,this.get)},c}())}])}.call(this),function(){angular.module("gwAnonShellApp").factory("PlaceAggregation",["Tree","constant.settings",function(a,b){var c,d,e,f,g,h,i,j;return d={},i={},h=function(a){return function(a,b,c){var d;return null!==a&&null!==b&&a!==b&&(null!=(d=f(a,c))&&!!_.find(d.victims,{isoa3:b}))}}(),g=function(a){return function(a,b,c){var d;return null!==a&&null!==b&&a!==b&&(null!=(d=f(b,c))&&!!_.find(d.victims,{isoa3:a}))}}(),f=function(a,b){var d,e;if(null!=a)return i[b.hash]||(i[b.hash]={}),null!=i[b.hash][a]?i[b.hash][a]:(d=c(b),e=_.find(d,{code:a}),i[b.hash][a]=e)},e=function(a){var b;return b=_.pluck(a.incorporated_in,"isoa3"),b=b.concat(_.pluck(a.usincorporated,"i_sous")),b=b.concat(_.pluck(a.caincorporated,"i_so"))},c=function(a){return function(a){var c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;if(null!=d[a.hash])return d[a.hash];for(j=function(a,b){return{code:a,name:b,cases:[],companies:[],victims:[],victims_places:[],victims_cases:[],victims_companies:[]}},o=function(a,c,d){var e,f,g;return e=a[c],-1!==b.excludePlaces.indexOf(e)?{}:(null==n[e]&&(n[e]=j(e,a.name)),f=d.involvement_in_cases||[],g=[],_.each(f,function(a){return _.each(a.victims,function(a){if(-1===b.excludePlaces.indexOf(a.code))return g.push(a)})}),n[e].count++,n[e].victims=_.uniq(n[e].victims.concat(g),"code"),n[e].cases=_.uniq(n[e].cases.concat(f),"id"),n[e].companies.push(d),n[e])},k=a.hash||_.uniqueId(),a=_.cloneDeep(a),a.hash=k,n={},c=[],s=0,w=a.length;s<w;s++){for(g=a[s],G=g.incorporated_in,t=0,x=G.length;t<x;t++)l=G[t],o(l,"isoa3",g).zone=null;for(H=g.usincorporated,u=0,y=H.length;u<y;u++)l=H[u],o(l,"i_sous",g).zone="United States";for(I=g.caincorporated,v=0,z=I.length;v<z;v++)l=I[v],o(l,"i_so",g).zone="Canada";c=c.concat(g.involvement_in_cases||[])}c=_.uniq(c,"id");for(f in n)for(m=n[f],J=m.victims,D=0,A=J.length;D<A;D++){for(q=J[D],null==n[q.isoa3]&&(n[q.isoa3]=j(q.isoa3,q.name)),n[q.isoa3].victims_cases=_.filter(c,function(a){return!!_.find(a.victims,{isoa3:q.isoa3})}),K=n[q.isoa3].victims_cases,E=0,B=K.length;E<B;E++)for(r=K[E],L=r.companyinvolvement,F=0,C=L.length;F<C;F++)g=L[F],n[q.isoa3].victims_companies.push(g),i=e(g),h=_.map(i,function(a){return n[a]}),n[q.isoa3].victims_places=n[q.isoa3].victims_places.concat(h);n[q.isoa3].victims_places=_.filter(n[q.isoa3].victims_places,function(a){return null!=a}),n[q.isoa3].victims_places=_.uniq(n[q.isoa3].victims_places,"code"),n[q.isoa3].victims_places=_.filter(n[q.isoa3].victims_places,function(a){return-1===b.excludePlaces.indexOf(a.isoa3)}),n[q.isoa3].victims_companies=_.uniq(n[q.isoa3].victims_companies,"id")}return p=_(n).sortBy(function(a){return a.companies.length}).reverse().value(),null!=a.hash&&(d[a.hash]=p),p}}(),j=a.then(c),angular.extend(j,{countByPlace:c,getPlace:f,hasCompaniesIn:g,hasVictimsIn:h})}])}.call(this),function(){angular.module("gwAnonShellApp").factory("Tree",["$q","Cases","Companies","Coordinates","constant.settings",function(a,b,c,d,e){return a.all([c,b,d]).then(function(a){var b,c,d;return c=a[0].data,b=a[1].data,d=a[2],_.map(b,function(a){return function(a){return _.extend(a,{victims:_.filter(a.victims,function(a){return-1===e.excludePlaces.indexOf(a.isoa3)})})}}()),_.map(c,function(a){return function(a){var f;return f=_.pluck(a.incorporated_in,"isoa3"),f=f.concat(_.pluck(a.usincorporated,"i_sous")),f=f.concat(_.pluck(a.caincorporated,"i_so")),_.extend(a,{incorporations:f,incorporated_in:_.filter(a.incorporated_in,function(a){return-1===e.excludePlaces.indexOf(a.isoa3)})}),_.each(a.involvement_in_cases,function(a){return _.extend(a,_.find(b,{id:a.id})),_.each(a.victims,function(a){var b;return b=_.find(d,{code:a.isoa3}),_.extend(a,b)}),_.each(a.companyinvolvement,function(a){return _.extend(a,_.find(c,{id:a.id}))})}),a}}()),c.hash=_.uniqueId(),c})}])}.call(this),function(){angular.module("gwAnonShellApp").factory("Utils",["constant.settings",function(a){return{caseCompaniesJuridictions:function(b,c){var d;return d=[],_.each(b.companyinvolvement,function(a){var b;return _.extend(a,_.find(c,{id:a.id})),b=[],b=b.concat(_.map(a.incorporated_in,function(a){return{name:a.name,code:a.isoa3,zone:"WORLD",id:a.id}})),b=b.concat(_.map(a.usincorporated,function(a){return{name:a.name,code:a.i_sous,zone:"USA",id:a.id}})),b=b.concat(_.map(a.caincorporated,function(a){return{name:a.name,code:a.i_so,zone:"CA",id:a.id}})),d=d.concat(b)}),d=_.uniq(d,"id"),_.filter(d,function(b){return-1===a.excludePlaces.indexOf(b.code)})}}}])}.call(this),function(){angular.module("gwAnonShellApp").filter("addTargetBlank",function(){return function(a){var b;return b=angular.element("<div>"+a+"</div>"),b.find("a").attr("target","_blank"),angular.element("<div>").append(b).html()}})}.call(this),function(){angular.module("gwAnonShellApp").filter("n",["inflector",function(a){return function(b,c){return c>1?a.pluralize(b):b}}])}.call(this),function(){angular.module("gwAnonShellApp").filter("stripTags",function(){return function(a){return String(a).replace(/<[^>]+>/gm,"")}})}.call(this),function(){angular.module("gwAnonShellApp").filter("wrapletters",function(){return function(a,b){var c,d;return null==b&&(b=""),c=a.split(""),d=c.join("</span><span class='"+b+"'>"),"<span class='"+b+"'>"+d+"</span>"}})}.call(this),function(){angular.module("gwAnonShellApp").filter("youtubeThumbnail",function(){return function(a,b){return null==b&&(b=0),"http://img.youtube.com/vi/"+function(a){var b,c;return c=a.split("v=")[1],b=c.indexOf("&"),-1!==b?c.substring(0,b):c}(a)+"/"+b+".jpg"}})}.call(this),function(){angular.module("gwAnonShellApp").filter("zerofill",function(){return function(a,b){return("000000000000000000000000000000000"+a).slice(-Math.max((""+a).length,b))}})}.call(this),function(){angular.module("gwAnonShellApp").controller("ShareCtrl",["$scope","$modalInstance","constant.settings",function(a,b,c){return a.link=c.url,a.width=880,a.height=690,a.close=b.close}])}.call(this);